<?xml version="1.0" encoding="UTF-8"?>
<project name="Ronco" default="compile" basedir="."> 
	<property name="source.dir" location="./src" />

	<property name="build.dest.dir" location="./classes" />
	<property name="classes.dir" location="${build.dest.dir}" />
	
	<property name="lib.dir" location="./lib" />
	
	<property name="ext.lib.dir" location="./vendor-lib" />
	
	<property name="web.dir" location="./webapp" />
	<property name="web.lib.dir" location="./lib" />
	<property name="webapp.lib.dir" location="./lib" />
	
	<property name="dist.dir" location="./../dist" />
	<property name="distapp.dir" location="./../distapp" />
	<property name="deploy.dir" location="./../deploy/ronco" />
	<property name="deploy.app.dir" location="./../deployapp" />
	
	<property name="deploy.web.dir" location="${deploy.app.dir}/WEB-INF" />
	<property name="deploy.web.lib.dir" location="${deploy.app.dir}/WEB-INF/lib" />
	<property name="deploy.web.classes.dir" location="${deploy.app.dir}/WEB-INF/classes" />

	<property name="deploy.lib.dir" location="${deploy.dir}/lib" />
	<property name="deploy.classes.dir" location="${deploy.dir}/classes" />
	
	<property name="db" value="postgres" />
	<!--<property name="env" value="dev" />-->
	

	
<!--
	<property name="server.password" value="isin2010"/>
	<property name="server.user" value="netlab"/>
	<property name="server.address" value="193.5.155.219"/>
	<property name="server.location" value="/usr/local/apache/apache-tomcat-6.0.29/webapps"/>
-->

	<property name="server.password" value="isin2010"/>
	<property name="server.user" value="netlab"/>
	<property name="server.address" value="localhost"/>
	<property name="server.location" value="/var/lib/tomcat7/webapps"/>


	<target name="clean" >
		<delete dir="${build.dest.dir}" />
		<delete dir="${dist.dir}" />
		<delete dir="${distapp.dir}" />
		<delete dir="${deploy.dir}" />
		<delete dir="${deploy.app.dir}" />
	</target>
	
	<!--
	<target name="class" >
		<mkdir dir="${build.dest.dir}" />
	</target>
	-->
	
	<target name="compile" depends="clean">
		<mkdir dir="${build.dest.dir}" />
		<path id="classpath"> 
		    <fileset dir="${lib.dir}">
		        <include name="*.jar"/>
		        <include name="**/*.jar"/>
		    </fileset>
		    <fileset dir="${ext.lib.dir}">
		        <include name="*.jar"/>
		        <include name="**/*.jar"/>
		    </fileset>
		    <fileset dir="${web.lib.dir}">
		        <include name="*.jar"/>
		        <include name="**/*.jar"/>
		    </fileset>
		    
		    <pathelement path="${java.class.path}"/>
		    <pathelement location="${build.dest.dir}" />
		</path>
		
		<!-- Compile  generated java  files  and original-->
		<javac srcdir="${source.dir}" destdir="${build.dest.dir}"  includeantruntime="false" debug="true" debuglevel="lines,vars,source">
			<classpath refid="classpath" />
			<include name="*/**/*.java" />
			<include name="*.java" />
		</javac>

		<copy file="${source.dir}/ronco.properties.${env}" tofile="${source.dir}/ronco.properties" overwrite="yes" />
		<copy file="${source.dir}/mail.properties.${env}" tofile="${source.dir}/mail.properties" overwrite="yes" />
		<copy file="${source.dir}/log4j.xml.${env}" tofile="${source.dir}/log4j.xml" overwrite="yes" />
		<!--<copy file="${source.dir}/promo.cfg.xml.${env}" tofile="${source.dir}/promo.cfg.xml" overwrite="yes" /> -->
		<copy todir="${build.dest.dir}" overwrite="yes">
			<fileset dir="${source.dir}">
				<include name="*.properties" />
				<include name="*.xml" />
				<include name="*/**/*.xml" />
			</fileset>
		</copy>
		

		<echo>***** deploy ********</echo>
		<mkdir dir="${deploy.dir}" />
		<mkdir dir="${deploy.lib.dir}" />
		<mkdir dir="${deploy.classes.dir}" />
		<copy todir="${deploy.lib.dir}" overwrite="yes">
			<fileset dir="${lib.dir}"> 
				<include name = "*/**/.jar" />
				<include name = "*.jar" />
			</fileset>
		</copy>
	
		<copy todir="${deploy.classes.dir}" overwrite="yes">
			<fileset dir="${classes.dir}"> 
				<include name = "*" />
				<include name = "*/**/*" />
			</fileset>
		</copy>
		

		<echo>******* deployapp ******</echo>
		<mkdir dir="${deploy.app.dir}" />
		<copy todir="${deploy.app.dir}" overwrite="yes">
			<fileset dir="${web.dir}"> 
				<include name = "*/**/*" />
				<include name = "*" />
			</fileset>
		</copy>
	
		<mkdir dir="${deploy.web.lib.dir}" />
		<mkdir dir="${deploy.web.classes.dir}" />	
		<copy todir="${deploy.web.lib.dir}" overwrite="yes">
			<fileset dir="${lib.dir}"> 
				<include name = "*/**/.jar" />
				<include name = "*.jar" />
			</fileset>
			<fileset dir="${webapp.lib.dir}"> 
				<include name = "*/**/.jar" />
				<include name = "*.jar" />
			</fileset>
		</copy>
		
		<copy todir="${deploy.web.classes.dir}" overwrite="yes">
			<fileset dir="${classes.dir}"> 
				<include name = "*" />
				<include name = "*/**/*" />
			</fileset>
		</copy>

	
	
		<echo>****** dist *******</echo>	
			<mkdir dir="${dist.dir}" />
			<zip destfile="${dist.dir}/ronco.zip" basedir="${deploy.dir}" />
			<zip destfile="${dist.dir}/ronco-classes.zip" basedir="${deploy.dir}/classes" />	
		
		
		<echo>***** distapp ********</echo>
		<mkdir dir="${distapp.dir}" />
		<jar destfile="${distapp.dir}/ronco.war" basedir="${deploy.app.dir}" />
		 
	
		<echo>NO *** Uploading... ***</echo>
		<!--<scp file="${distapp.dir}/promoadmin.war" todir="${server.user}@${server.address}:${server.location}" password="${server.password}" trust="true"/>
-->

	</target>
	

	<target name="deploy" depends="compile">
		<mkdir dir="${deploy.dir}" />
		<mkdir dir="${deploy.lib.dir}" />
		<mkdir dir="${deploy.classes.dir}" />
		<copy todir="${deploy.lib.dir}" overwrite="yes">
			<fileset dir="${lib.dir}"> 
				<include name = "*/**/.jar" />
				<include name = "*.jar" />
			</fileset>
		</copy>

		<copy todir="${deploy.classes.dir}" overwrite="yes">
			<fileset dir="${classes.dir}"> 
				<include name = "*" />
				<include name = "*/**/*" />
			</fileset>
		</copy>
		<!--<copy file="${source.dir}/log4j.xml.server" tofile="${deploy.classes.dir}/log4j.xml" overwrite="yes" />-->
	
	</target>
	
	

	<target name="deployapp" depends="compile">
		<mkdir dir="${deploy.app.dir}" />
		<copy todir="${deploy.app.dir}" overwrite="yes">
			<fileset dir="${web.dir}"> 
				<include name = "*/**/*" />
				<include name = "*" />
			</fileset>
		</copy>
	
		<mkdir dir="${deploy.web.lib.dir}" />
		<mkdir dir="${deploy.web.classes.dir}" />	
		<copy todir="${deploy.web.lib.dir}" overwrite="yes">
			<fileset dir="${lib.dir}"> 
				<include name = "*/**/.jar" />
				<include name = "*.jar" />
			</fileset>
			<fileset dir="${webapp.lib.dir}"> 
				<include name = "*/**/.jar" />
				<include name = "*.jar" />
			</fileset>
		</copy>
		
		<copy todir="${deploy.web.classes.dir}" overwrite="yes">
			<fileset dir="${classes.dir}"> 
				<include name = "*" />
				<include name = "*/**/*" />
			</fileset>
		</copy>

		<!--<copy file="${source.dir}/log4j.xml.web" tofile="${deploy.web.classes.dir}/log4j.xml" overwrite="yes" />-->
	</target>

	
	<target name="dist" depends="deploy">
		<mkdir dir="${dist.dir}" />
		<zip destfile="${dist.dir}/ronco.zip" basedir="${deploy.dir}" />
		<zip destfile="${dist.dir}/ronco-classes.zip" basedir="${deploy.dir}/classes" />

		<zip destfile="${dist.dir}/ronco-server-classes.zip" basedir="${deploy.dir}/classes" excludes="it/ash/tracking/server/beans/**,it/ash/tracking/server/actions/**,it/ash/tracking/server/forms/**" />
	</target>
	
	<target name="distapp" depends="deployapp">
		<mkdir dir="${distapp.dir}" />
		<jar destfile="${distapp.dir}/ronco.war" basedir="${deploy.app.dir}" />
	</target>
	
	<target name="dist.dependencies">		
	        <antcall target="depend.${ant.project.name}"/>
	</target>
</project>
